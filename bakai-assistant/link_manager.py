#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑÑ‹Ð»ÐºÐ°Ð¼Ð¸ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð±Ð°Ð½ÐºÐ°
"""

from typing import Dict, List, Optional
from langchain.docstore.document import Document
from config import BANK_LINKS

class BakaiLinkManager:
    """Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑÑ‹Ð»ÐºÐ°Ð¼Ð¸ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð±Ð°Ð½ÐºÐ°"""
    
    def __init__(self):
        self.link_patterns = self._init_link_patterns()
        self.category_priorities = self._init_category_priorities()
    
    def _init_link_patterns(self) -> Dict[str, List[str]]:
        """Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð¾Ð² Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð½ÑƒÐ¶Ð½Ñ‹Ñ… ÑÑÑ‹Ð»Ð¾Ðº"""
        return {
            "cards": [
                # ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ñ‹ (Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚)
                "ÐºÐ°Ñ€Ñ‚Ð°", "ÐºÐ°Ñ€Ñ‚Ñƒ", "ÐºÐ°Ñ€Ñ‚Ñ‹", "Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð°", "Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°",
                "Ð´ÐµÐ±ÐµÑ‚Ð¾Ð²Ð°Ñ", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°", "visa", "mastercard", "ÑÐ»ÐºÐ°Ñ€Ñ‚", "elkart",
                # Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ñ ÐºÐ°Ñ€Ñ‚Ð°Ð¼Ð¸
                "Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ", "Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ", "Ð·Ð°ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ", "Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ",
                # Ð¡Ð¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ñ‹ (ÑÑ€ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚)
                "ÐºÐµÑˆÐ±ÑÐº", "cashback", "ÑÑ‚Ð¸ÐºÐµÑ€", "Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ñ‹Ð¹ ÑÑ‚Ð¸ÐºÐµÑ€", "nfc", "Ð±ÐµÑÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð½Ð°Ñ",
                "Ñ‚ÑƒÐ¼Ð°Ñ€", "Ñ€Ð°ÑÑÑ€Ð¾Ñ‡ÐºÐ°", "Ð¿Ð¸Ð½ ÐºÐ¾Ð´", "Ð¿Ð¸Ð½-ÐºÐ¾Ð´", "cvv", "cvc"
            ],
            "credits": [
                "ÐºÑ€ÐµÐ´Ð¸Ñ‚", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð°", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ñ‹", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ñ‹Ð¹", "Ð·Ð°Ð¹Ð¼", "Ð·Ð°ÐµÐ¼", "ÑÑÑƒÐ´Ð°",
                "Ð¸Ð¿Ð¾Ñ‚ÐµÐºÐ°", "Ð¸Ð¿Ð¾Ñ‚ÐµÑ‡Ð½Ñ‹Ð¹", "Ð°Ð²Ñ‚Ð¾ÐºÑ€ÐµÐ´Ð¸Ñ‚", "Ð°Ð²Ñ‚Ð¾ ÐºÑ€ÐµÐ´Ð¸Ñ‚", "Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ ÐºÑ€ÐµÐ´Ð¸Ñ‚",
                "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²Ð°Ð½Ð¸Ðµ", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚", "Ð²Ð·ÑÑ‚ÑŒ ÐºÑ€ÐµÐ´Ð¸Ñ‚", "Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÑ€ÐµÐ´Ð¸Ñ‚",
                "Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ ÐºÑ€ÐµÐ´Ð¸Ñ‚", "ÑÑ‚Ð°Ð²ÐºÐ° ÐºÑ€ÐµÐ´Ð¸Ñ‚", "ÑƒÑÐ»Ð¾Ð²Ð¸Ñ ÐºÑ€ÐµÐ´Ð¸Ñ‚", "Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð½Ð°Ñ ÑÑ‚Ð°Ð²ÐºÐ°",
                "Ð´Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ðµ Ð¿Ð¾Ð³Ð°ÑˆÐµÐ½Ð¸Ðµ", "Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹", "Ñ€ÐµÑ„Ð¸Ð½Ð°Ð½ÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ"
            ],
            "deposits": [
                "Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚", "Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð°", "Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ñ‹", "Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð½Ñ‹Ð¹", "Ð²ÐºÐ»Ð°Ð´", "Ð²ÐºÐ»Ð°Ð´Ð°", "Ð²ÐºÐ»Ð°Ð´Ñ‹",
                "Ð½Ð°ÐºÐ¾Ð¿Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹", "ÑÐ±ÐµÑ€ÐµÐ³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹", "ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð²ÐºÐ»Ð°Ð´", "Ð±ÐµÑÑÑ€Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð²ÐºÐ»Ð°Ð´",
                "Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚", "Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð²ÐºÐ»Ð°Ð´", "Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚", "Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð½Ð°Ñ ÑÑ‚Ð°Ð²ÐºÐ°",
                "ÐºÐ°Ð¿Ð¸Ñ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ", "Ð¿Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚", "ÑÐ½ÑÑ‚ÑŒ Ñ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð°", "Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ñ‹",
                "ÑÐ±ÐµÑ€ÐµÐ³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚", "Ð½Ð°ÐºÐ¾Ð¿Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚"
            ],
            "business": [
                "Ñ€Ð°ÑÑ‡ÐµÑ‚Ð½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚", "Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð½Ñ‹Ð¹ ÑÑ‡Ñ‘Ñ‚", "Ñ€/Ñ", "Ñ€Ñ", "Ñ€Ð°ÑÑ‡ÐµÑ‚ÐºÐ°",
                "ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹", "Ð±Ð¸Ð·Ð½ÐµÑ", "ÑŽÑ€Ð¸Ð´Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð»Ð¸Ñ†Ð¾", "ÑŽÑ€Ð»Ð¸Ñ†Ð¾", "ÑŽÑ€ Ð»Ð¸Ñ†Ð¾",
                "Ð¸Ð¿", "Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒ", "Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒ",
                "ÑÑ‡ÐµÑ‚ Ð´Ð»Ñ Ð±Ð¸Ð·Ð½ÐµÑÐ°", "Ð±Ð¸Ð·Ð½ÐµÑ ÑÑ‡ÐµÑ‚", "ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°", "ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚",
                "ÑÐºÐ²Ð°Ð¹Ñ€Ð¸Ð½Ð³", "pos Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»", "Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»", "Ð¸Ð½ÐºÐ°ÑÑÐ°Ñ†Ð¸Ñ", "Ð¸Ð½ÐºÐ°ÑÑÐ¾",
                "Ð±Ð°Ð½Ðº-ÐºÐ»Ð¸ÐµÐ½Ñ‚", "Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚", "Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð¾Ð±Ð¾Ñ€Ð¾Ñ‚"
            ],
            "branches": [
                "Ñ„Ð¸Ð»Ð¸Ð°Ð»", "Ñ„Ð¸Ð»Ð¸Ð°Ð»Ð°", "Ñ„Ð¸Ð»Ð¸Ð°Ð»Ðµ", "Ñ„Ð¸Ð»Ð¸Ð°Ð»Ñ‹", "ÑÐ±ÐµÑ€ÐºÐ°ÑÑÐ°", "ÑÐ±ÐµÑ€ÐºÐ°ÑÑÑ‹", "ÑÐ±ÐµÑ€ÐºÐ°ÑÑÐµ",
                "Ð¾Ñ„Ð¸Ñ", "Ð¾Ñ„Ð¸ÑÐ°", "Ð¾Ñ„Ð¸ÑÐµ", "Ð¾Ñ„Ð¸ÑÑ‹", "Ð³Ð¾Ð»Ð¾Ð²Ð½Ð¾Ð¹ Ð¾Ñ„Ð¸Ñ", "Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¾Ñ„Ð¸Ñ", "Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ„Ð¸Ñ",
                "Ð°Ð´Ñ€ÐµÑ", "Ð°Ð´Ñ€ÐµÑÐ°", "Ð°Ð´Ñ€ÐµÑÐµ", "Ð³Ð´Ðµ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ", "Ð³Ð´Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½", "Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ",
                "Ð³Ñ€Ð°Ñ„Ð¸Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹", "Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹", "Ñ‡Ð°ÑÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹", "Ð²Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹",
                "Ñ‚Ñ‹Ð½Ñ‹ÑÑ‚Ð°Ð½Ð¾Ð²Ð°", "Ð°Ð±Ð´Ñ€Ð°Ñ…Ð¼Ð°Ð½Ð¾Ð²Ð°", "Ð±Ð¸ÑˆÐºÐµÐº", "Ð¼ÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
            ],
            "atm": [
                "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚", "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ð°", "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ñ‹", "atm", "Ð°Ñ‚Ð¼", "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ðµ",
                "ÑÐ½ÑÑ‚ÑŒ Ð´ÐµÐ½ÑŒÐ³Ð¸", "ÑÐ½ÑÑ‚ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ", "ÑÐ½ÑÑ‚Ð¸Ðµ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ñ…", "Ð²Ñ‹Ð´Ð°Ñ‡Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ñ…",
                "Ð³Ð´Ðµ Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚", "Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ð¹ Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚", "ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ñ Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚", "Ð»Ð¸Ð¼Ð¸Ñ‚ Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚",
                "Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ð°", "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
            ],
            "insurance": [
                "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²ÐºÐ°", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð¾Ð¹", "Ð¿Ð¾Ð»Ð¸Ñ", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚",
                "Ð·Ð°ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ñ‚ÑŒ", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ð°", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð¾Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ",
                "Ð¾ÑÐ°Ð³Ð¾", "ÐºÐ°ÑÐºÐ¾", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¶Ð¸Ð·Ð½Ð¸", "Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ°Ñ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²ÐºÐ°",
                "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð¾Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ñ Ð²Ñ‹Ð¿Ð»Ð°Ñ‚Ð°"
            ],
            "transfers": [
                "Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´", "Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ñ‹", "Ð´ÐµÐ½ÐµÐ¶Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´", "Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð´ÐµÐ½ÑŒÐ³Ð¸",
                "Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ", "Ð¿Ð»Ð°Ñ‚ÐµÐ¶", "Ð¾Ð¿Ð»Ð°Ñ‚Ð°", "Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ Ð´ÐµÐ½ÑŒÐ³Ð¸", "Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð¸",
                "Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´", "Ð¼ÐµÐ¶Ð´ÑƒÐ½Ð°Ñ€Ð¾Ð´Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´", "Ð²Ð°Ð»ÑŽÑ‚Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´",
                "ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´", "Ð»Ð¸Ð¼Ð¸Ñ‚ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð°", "ÑÑ€Ð¾Ðº Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð°"
            ],
            "exchange": [
                "Ð¾Ð±Ð¼ÐµÐ½ Ð²Ð°Ð»ÑŽÑ‚", "Ð²Ð°Ð»ÑŽÑ‚Ð°", "ÐºÑƒÑ€Ñ", "Ð´Ð¾Ð»Ð»Ð°Ñ€", "ÐµÐ²Ñ€Ð¾", "ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ñ",
                "Ð²Ð°Ð»ÑŽÑ‚Ð½Ñ‹Ð¹", "Ð¾Ð±Ð¼ÐµÐ½ÐºÐ°", "ÐºÑƒÑ€Ñ Ð²Ð°Ð»ÑŽÑ‚", "Ð¾Ð±Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð²Ð°Ð»ÑŽÑ‚Ñƒ",
                "Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ° Ð²Ð°Ð»ÑŽÑ‚Ñ‹", "Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð° Ð²Ð°Ð»ÑŽÑ‚Ñ‹", "Ð²Ð°Ð»ÑŽÑ‚Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸",
                "ÐºÑƒÑ€Ñ Ð´Ð¾Ð»Ð»Ð°Ñ€Ð°", "ÐºÑƒÑ€Ñ ÐµÐ²Ñ€Ð¾", "Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÑƒÑ€Ñ"
            ],
            "services": [
                "ÑƒÑÐ»ÑƒÐ³Ð°", "ÑƒÑÐ»ÑƒÐ³Ð¸", "ÑÐµÑ€Ð²Ð¸Ñ", "ÑÐµÑ€Ð²Ð¸ÑÑ‹", "Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¸Ðµ ÑƒÑÐ»ÑƒÐ³Ð¸",
                "Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑƒÑÐ»ÑƒÐ³Ð¸", "Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹", "Ñ‚Ð°Ñ€Ð¸Ñ„Ð½Ñ‹Ð¹ Ð¿Ð»Ð°Ð½",
                "ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ñ", "ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ð¸", "ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ"
            ]
        }
    
    def _init_category_priorities(self) -> Dict[str, int]:
        """Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹"""
        return {
            "cards": 100,
            "credits": 95,
            "deposits": 90,
            "business": 85,
            "insurance": 80,
            "transfers": 75,
            "exchange": 70,
            "branches": 65,
            "atm": 60,
            "services": 50
        }
    
    def _get_pattern_weight(self, pattern: str, category: str) -> float:
        """ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð²ÐµÑÐ° Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð° Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ ÐµÐ³Ð¾ Ð²Ð°Ð¶Ð½Ð¾ÑÑ‚Ð¸"""
        # ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ñ‹ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÑŽÑ‚ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²ÐµÑ)
        primary_terms = {
            "cards": ["ÐºÐ°Ñ€Ñ‚Ð°", "ÐºÐ°Ñ€Ñ‚Ñƒ", "ÐºÐ°Ñ€Ñ‚Ñ‹", "Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð°", "Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°", 
                     "Ð´ÐµÐ±ÐµÑ‚Ð¾Ð²Ð°Ñ", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°", "visa", "mastercard", "ÑÐ»ÐºÐ°Ñ€Ñ‚"],
            "credits": ["ÐºÑ€ÐµÐ´Ð¸Ñ‚", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð°", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ñ‹", "ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ñ‹Ð¹", "Ð·Ð°Ð¹Ð¼", "Ð¸Ð¿Ð¾Ñ‚ÐµÐºÐ°"],
            "deposits": ["Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚", "Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð°", "Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ñ‹", "Ð²ÐºÐ»Ð°Ð´", "Ð²ÐºÐ»Ð°Ð´Ð°", "Ð²ÐºÐ»Ð°Ð´Ñ‹"],
            "business": ["Ñ€Ð°ÑÑ‡ÐµÑ‚Ð½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚", "Ð±Ð¸Ð·Ð½ÐµÑ", "ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹", "ÑŽÑ€Ð¸Ð´Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð»Ð¸Ñ†Ð¾", "Ð¸Ð¿"],
            "branches": ["Ñ„Ð¸Ð»Ð¸Ð°Ð»", "Ð¾Ñ„Ð¸Ñ", "Ð°Ð´Ñ€ÐµÑ", "Ð³Ñ€Ð°Ñ„Ð¸Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹"],
            "atm": ["Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚", "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ð°", "Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ñ‹", "atm", "Ð°Ñ‚Ð¼"],
            "insurance": ["ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ", "ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²ÐºÐ°", "Ð¿Ð¾Ð»Ð¸Ñ"],
            "transfers": ["Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´", "Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ñ‹", "Ð¿Ð»Ð°Ñ‚ÐµÐ¶", "Ð¾Ð¿Ð»Ð°Ñ‚Ð°"],
            "exchange": ["Ð¾Ð±Ð¼ÐµÐ½ Ð²Ð°Ð»ÑŽÑ‚", "Ð²Ð°Ð»ÑŽÑ‚Ð°", "ÐºÑƒÑ€Ñ"],
            "services": ["ÑƒÑÐ»ÑƒÐ³Ð°", "ÑƒÑÐ»ÑƒÐ³Ð¸", "ÑÐµÑ€Ð²Ð¸Ñ"]
        }
        
        # Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ‚ÐµÑ€Ð¼Ð¸Ð½ - Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð²ÐµÑ
        if pattern in primary_terms.get(category, []):
            return 10.0
        
        # Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ ÑÐ¾ÑÑ‚Ð°Ð²Ð½Ð°Ñ Ñ„Ñ€Ð°Ð·Ð° - ÑÑ€ÐµÐ´Ð½Ð¸Ð¹ Ð²ÐµÑ
        if len(pattern.split()) > 1:
            return 3.0
        
        # ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ñ‹ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð²ÐµÑ
        return 1.0
    
    def get_relevant_link(self, query: str, documents: List[Document] = None) -> str:
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÐµÐ¹ ÑÑÑ‹Ð»ÐºÐ¸"""
        query_lower = query.lower()
        
        # 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð½Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ñ… ÑÑÑ‹Ð»Ð¾Ðº
        if documents:
            specific_link = self._extract_link_from_documents(documents, query_lower)
            if specific_link:
                return specific_link
        
        # 2. ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ð¿Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ ÑÐ»Ð¾Ð²Ð°Ð¼
        category = self._determine_category(query_lower)
        
        # 3. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ
        link = BANK_LINKS.get(category, BANK_LINKS["general"])
        
        print(f"ðŸ”— Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð° ÑÑÑ‹Ð»ÐºÐ° Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ '{category}': {link}")
        return link
    
    def _extract_link_from_documents(self, documents: List[Document], query_lower: str) -> Optional[str]:
        """Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐ¸ Ð¸Ð· Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²"""
        for doc in documents:
            if hasattr(doc, 'metadata') and doc.metadata:
                doc_url = doc.metadata.get('url', '')
                
                if doc_url and doc_url.startswith('http'):
                    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚ÑŒ URL Ðº Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ
                    if self._is_url_relevant(doc_url, query_lower):
                        print(f"ðŸŽ¯ ÐÐ°Ð¹Ð´ÐµÐ½Ð° ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ…: {doc_url}")
                        return doc_url
        
        return None
    
    def _is_url_relevant(self, url: str, query_lower: str) -> bool:
        """ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ð¸ URL Ðº Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ"""
        url_lower = url.lower()
        
        # Ð¡Ð»Ð¾Ð²Ð°Ñ€ÑŒ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ð¹ URL Ð¸ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… ÑÐ»Ð¾Ð²
        url_keywords = {
            'card': ['ÐºÐ°Ñ€Ñ‚', 'visa', 'mastercard', 'ÑÐ»ÐºÐ°Ñ€Ñ‚'],
            'credit': ['ÐºÑ€ÐµÐ´Ð¸Ñ‚', 'Ð·Ð°Ð¹Ð¼', 'Ð¸Ð¿Ð¾Ñ‚ÐµÐº'],
            'deposit': ['Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚', 'Ð²ÐºÐ»Ð°Ð´', 'Ð½Ð°ÐºÐ¾Ð¿Ð¸Ñ‚ÐµÐ»ÑŒ'],
            'business': ['Ð±Ð¸Ð·Ð½ÐµÑ', 'ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²', 'Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»'],
            'office': ['Ð¾Ñ„Ð¸Ñ', 'Ñ„Ð¸Ð»Ð¸Ð°Ð»', 'Ð°Ð´Ñ€ÐµÑ'],
            'insurance': ['ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²', 'Ð¿Ð¾Ð»Ð¸Ñ'],
            'transfer': ['Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´', 'Ð¿Ð»Ð°Ñ‚ÐµÐ¶'],
            'exchange': ['Ð²Ð°Ð»ÑŽÑ‚', 'ÐºÑƒÑ€Ñ', 'Ð¾Ð±Ð¼ÐµÐ½']
        }
        
        for url_pattern, keywords in url_keywords.items():
            if url_pattern in url_lower:
                if any(keyword in query_lower for keyword in keywords):
                    return True
        
        return False
    
    def _determine_category(self, query_lower: str) -> str:
        """ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ ÑÐ»Ð¾Ð²Ð°Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°"""
        category_scores = {}
        
        # ÐŸÐ¾Ð´ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ ÑÐ¾Ð²Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
        for category, patterns in self.link_patterns.items():
            score = 0
            matched_patterns = []
            
            for pattern in patterns:
                if pattern in query_lower:
                    # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð²ÐµÑ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð° Ð²Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ð¸Ð½Ñ‹ Ñ„Ñ€Ð°Ð·Ñ‹
                    pattern_weight = self._get_pattern_weight(pattern, category)
                    
                    # Ð¢Ð¾Ñ‡Ð½Ð¾Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð±Ð°Ð»Ð»Ñ‹
                    exact_bonus = 5 if pattern == query_lower.strip() else 0
                    
                    pattern_score = pattern_weight + exact_bonus
                    score += pattern_score
                    matched_patterns.append((pattern, pattern_score))
            
            if score > 0:
                # ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
                priority = self.category_priorities.get(category, 50)
                category_scores[category] = {
                    'score': score * (priority / 100),
                    'raw_score': score,
                    'priority': priority,
                    'patterns': matched_patterns
                }
        
        # Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ñ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð±Ð°Ð»Ð»Ð¾Ð¼
        if category_scores:
            best_category = max(category_scores, key=lambda x: category_scores[x]['score'])
            best_score = category_scores[best_category]['score']
            
            print(f"ðŸŽ¯ ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ '{best_category}' Ñ Ð±Ð°Ð»Ð»Ð¾Ð¼ {best_score:.1f}")
            print(f"ðŸ“Š Ð¡Ð¾Ð²Ð¿Ð°Ð²ÑˆÐ¸Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹: {category_scores[best_category]['patterns']}")
            
            return best_category
        
        # ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ - Ð¾Ð±Ñ‰Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°
        print("ðŸ”— ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð°, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¾Ð±Ñ‰ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ")
        return "general"
    
    def get_category_info(self, category: str) -> Dict[str, any]:
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"""
        category_info = {
            "cards": {
                "name": "Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¸Ðµ ÐºÐ°Ñ€Ñ‚Ñ‹",
                "description": "Ð”ÐµÐ±ÐµÑ‚Ð¾Ð²Ñ‹Ðµ Ð¸ ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ñ‹Ðµ ÐºÐ°Ñ€Ñ‚Ñ‹, ÑÑ‚Ð¸ÐºÐµÑ€Ñ‹, Ñ€Ð°ÑÑÑ€Ð¾Ñ‡ÐºÐ°",
                "keywords_count": len(self.link_patterns.get("cards", []))
            },
            "credits": {
                "name": "ÐšÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²Ð°Ð½Ð¸Ðµ",
                "description": "ÐŸÐ¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ ÐºÑ€ÐµÐ´Ð¸Ñ‚Ñ‹, Ð¸Ð¿Ð¾Ñ‚ÐµÐºÐ°, Ð°Ð²Ñ‚Ð¾ÐºÑ€ÐµÐ´Ð¸Ñ‚Ñ‹",
                "keywords_count": len(self.link_patterns.get("credits", []))
            },
            "deposits": {
                "name": "Ð”ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ñ‹ Ð¸ Ð²ÐºÐ»Ð°Ð´Ñ‹",
                "description": "Ð¡Ñ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¸ Ð½Ð°ÐºÐ¾Ð¿Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð²ÐºÐ»Ð°Ð´Ñ‹",
                "keywords_count": len(self.link_patterns.get("deposits", []))
            },
            "business": {
                "name": "Ð‘Ð¸Ð·Ð½ÐµÑ-ÑƒÑÐ»ÑƒÐ³Ð¸",
                "description": "Ð Ð°ÑÑ‡ÐµÑ‚Ð½Ñ‹Ðµ ÑÑ‡ÐµÑ‚Ð°, ÐºÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ ÐºÐ°Ñ€Ñ‚Ñ‹, ÑÐºÐ²Ð°Ð¹Ñ€Ð¸Ð½Ð³",
                "keywords_count": len(self.link_patterns.get("business", []))
            },
            "branches": {
                "name": "ÐžÑ„Ð¸ÑÑ‹ Ð¸ Ñ„Ð¸Ð»Ð¸Ð°Ð»Ñ‹",
                "description": "ÐÐ´Ñ€ÐµÑÐ°, Ð³Ñ€Ð°Ñ„Ð¸Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹, Ð¼ÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ",
                "keywords_count": len(self.link_patterns.get("branches", []))
            },
            "atm": {
                "name": "Ð‘Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ñ‹",
                "description": "Ð Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð±Ð°Ð½ÐºÐ¾Ð¼Ð°Ñ‚Ð¾Ð², ÑÐ½ÑÑ‚Ð¸Ðµ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ñ…",
                "keywords_count": len(self.link_patterns.get("atm", []))
            },
            "insurance": {
                "name": "Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ",
                "description": "Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ Ð¸ Ð¿Ð¾Ð»Ð¸ÑÑ‹",
                "keywords_count": len(self.link_patterns.get("insurance", []))
            },
            "transfers": {
                "name": "ÐŸÐµÑ€ÐµÐ²Ð¾Ð´Ñ‹ Ð¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð¸",
                "description": "Ð”ÐµÐ½ÐµÐ¶Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ñ‹, Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ñ‹Ðµ ÑƒÑÐ»ÑƒÐ³Ð¸",
                "keywords_count": len(self.link_patterns.get("transfers", []))
            },
            "exchange": {
                "name": "Ð’Ð°Ð»ÑŽÑ‚Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸",
                "description": "ÐžÐ±Ð¼ÐµÐ½ Ð²Ð°Ð»ÑŽÑ‚, Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÑƒÑ€ÑÑ‹",
                "keywords_count": len(self.link_patterns.get("exchange", []))
            }
        }
        
        return category_info.get(category, {
            "name": "ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ",
            "description": "ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾",
            "keywords_count": 0
        })
    
    def analyze_query_categories(self, query: str) -> Dict[str, float]:
        """ÐÐ½Ð°Ð»Ð¸Ð· Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð¿Ð¾ Ð²ÑÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ Ñ Ð±Ð°Ð»Ð»Ð°Ð¼Ð¸"""
        query_lower = query.lower()
        analysis = {}
        
        for category, patterns in self.link_patterns.items():
            score = 0
            matched_patterns = []
            
            for pattern in patterns:
                if pattern in query_lower:
                    pattern_weight = self._get_pattern_weight(pattern, category)
                    exact_bonus = 5 if pattern == query_lower.strip() else 0
                    pattern_score = pattern_weight + exact_bonus
                    score += pattern_score
                    matched_patterns.append(pattern)
            
            if score > 0:
                priority = self.category_priorities.get(category, 50)
                final_score = score * (priority / 100)
                
                analysis[category] = {
                    "score": final_score,
                    "raw_score": score,
                    "priority": priority,
                    "matched_patterns": matched_patterns,
                    "link": BANK_LINKS.get(category, BANK_LINKS["general"])
                }
        
        return analysis
    
    def get_all_categories(self) -> List[str]:
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ð²ÑÐµÑ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹"""
        return list(self.link_patterns.keys())
    
    def validate_links(self) -> Dict[str, bool]:
        """ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ð²ÑÐµÑ… ÑÑÑ‹Ð»Ð¾Ðº (Ð±Ð°Ð·Ð¾Ð²Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°)"""
        validation_results = {}
        
        for category, url in BANK_LINKS.items():
            # Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð° URL
            is_valid = (
                isinstance(url, str) and
                len(url) > 0 and
                (url.startswith('http://') or url.startswith('https://'))
            )
            validation_results[category] = is_valid
        
        return validation_results